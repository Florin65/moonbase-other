if [ ! "`get_module_config shown_message`" == "yes" ]; then
    set_module_config shown_message yes
    message  "${MESSAGE_COLOR}**WARNING** This module will take alot of time and resources to"  
    message  "compile, just to give you a idea you will need atleast" 
    message  "4GB worth of free space, compile time will depend on" 
    message  "your CPU and RAM on your system.  On a Athlon XP 1800+ it used " 
    message  "to take good 7-8 hours to compile with all the languages"
    message  "It now takes about 3 times less time."
    message  ""
    message  "If you wish to compile Java into OpenOffice.org, please exit"
    message  "this install and lin j2sdk or j2sdk-beta to enable Java support."

    sleep 5
fi

LGET ()
{
    #only works in a lunar script as get_url is defined by download.lunar
    # and $SOURCE_CACHE is an internal lunar variable
    get_url $1 $SOURCE_CACHE/`basename $1`
}

Select_dicts ()
{
    # Configure happens before normal downloading of sources.
    for file in $SOURCE5 $SOURCE6 $SOURCE7
    do
    	if [ ! -e $SOURCE_CACHE/`basename $file` ]; then
            LGET $DICT_URL/$file
	fi
    done
    
    OLD_IFS=$IFS
    IFS=":"
         DICTS=(`awk 'BEGIN {FS=","; OFS=":"; ORS=":"}{ print $4,$3,"off" }' \
                      $SOURCE_CACHE/available.lst`)
    HYPH_DICTS=(`awk 'BEGIN {FS=","; OFS=":"; ORS=":"}{ print $4,$3,"off" }' \
                      $SOURCE_CACHE/hyphavail.lst`)
    THES_DICTS=(`awk 'BEGIN {FS=","; OFS=":"; ORS=":"}{ print $4,$3,"off" }' \
                      $SOURCE_CACHE/thesavail.lst`)

    SEL_DICTS=` \
    dialog --stdout --backtitle "OpenOffice dictionary selection" --single-quoted \
           --checklist "Select spellchecker dictionaries to install" 0 60 10 \
           ${DICTS[@]}`
    SEL_HYPH_DICTS=` \
    dialog --stdout --backtitle "OpenOffice dictionary selection" --single-quoted \
           --checklist "Select hyphenation dictionaries to install" 0 60 10 \
           ${HYPH_DICTS[@]}`
    SEL_THES_DICTS=` \
    dialog --stdout --backtitle "OpenOffice dictionary selection" --single-quoted  \
           --checklist "Select thesaurus dictionaries to install" 0 60 10 \
           ${THES_DICTS[@]}`

    # Yes after the dialog stuff otherwise it breaks
    IFS=$OLD_IFS
}

select_languages()
{
    AVA_LANGS=`cat $SCRIPT_DIRECTORY/ooo-langs` &&
    SEL_LANGS=` \
    dialog --stdout --backtitle "OpenOffice language support" --single-quoted \
               --checklist "Select which languages you wish to have the menus in." 0 0 10 $AVA_LANGS`
}

# This dates the CONFIGURE file allowing us to force a reconfigure :-)
if [ -z "`get_module_config CONFIGURED_DATE`" ] || [ `get_module_config CONFIGURED_DATE` -lt "2004101300" ]; then

    dialog --backtitle "OpenOffice dictionary selection" \
           --msgbox "The following menus will provide the selection for the dictionaries for the spellchecker, hyphenation rules, and thesaurus as well as provide selection of the languages used in the menus" 10 60

    Select_dicts &&
    select_languages &&

    # format the dictionaries in a nice fashion.
    SEL_DICTS=`echo $SEL_DICTS |sed -e "s/'[[:space:]]*'/;/g" -e "s/['[:space:]]*$//" -e "s/^['[:space:]]*//"`
    SEL_HYPH_DICTS=`echo $SEL_HYPH_DICTS |sed -e "s/'[[:space:]]*'/;/g" -e "s/['[:space:]]*$//" -e "s/^['[:space:]]*//"`
    SEL_THES_DICTS=`echo $SEL_THES_DICTS |sed -e "s/'[[:space:]]*'/;/g" -e "s/['[:space:]]*$//" -e "s/^['[:space:]]*//"`
        
    set_module_config CONFIGURED_DATE `date +%Y%m%d%H`
    set_module_config SEL_DICTS      "'$SEL_DICTS'"
    set_module_config SEL_HYPH_DICTS "'$SEL_HYPH_DICTS'"
    set_module_config SEL_THES_DICTS "'$SEL_THES_DICTS'"
    set_module_config SEL_LANGS      "'$SEL_LANGS'"

fi
