#!/bin/bash
#
# /etc/init.d/rc script, supports switching back and forth runlevels
# -sofar
#

umask 022
trap ":" INT QUIT TSTP

echo "Init: leaving runlevel $PREVLEVEL"

if [ "$PREVLEVEL" != "N" ] ; then
  for SCRIPT in /etc/rc$RUNLEVEL.d/K* ; do
    BASENAME=${SCRIPT:14}
    [ ! -e /etc/rc$PREVLEVEL.d/K??$BASENAME ]  &&
      [ -h /etc/rc$RUNLEVEL.d/K??$BASENAME  ]  &&
      [ -e /etc/init.d/$BASENAME            ]  &&
      /etc/init.d/$BASENAME stop
  done
fi

echo "Init: leaving runlevel $PREVLEVEL complete, entering runlevel $RUNLEVEL"

for SCRIPT in /etc/rc$RUNLEVEL.d/S* ; do
  BASENAME=${SCRIPT:14}
  [ ! -e /etc/rc$PREVLEVEL.d/S??$BASENAME ]  &&
    [ -h /etc/rc$RUNLEVEL.d/S??$BASENAME  ]  &&
    [ -e /etc/init.d/$BASENAME            ]  &&
    /etc/init.d/$BASENAME start
done

echo "Init: entering runlevel $RUNLEVEL complete"

